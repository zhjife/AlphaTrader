<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaTrader Pro - Aè‚¡å…¨ç»´é‡åŒ–ç»ˆç«¯</title>
    <style>
        :root { --bg: #0f1115; --card: #1b1e26; --text: #e0e0e0; --red: #f6465d; --green: #0ecb81; --blue: #2979ff; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* é¡¶éƒ¨æœç´¢æ  */
        .header { display: flex; gap: 10px; margin-bottom: 30px; justify-content: center; }
        input { background: var(--card); border: 1px solid #333; color: white; padding: 12px; border-radius: 4px; font-size: 16px; outline: none; }
        button { background: var(--blue); color: white; border: none; padding: 12px 24px; border-radius: 4px; font-size: 16px; cursor: pointer; }
        button:hover { background: #1e60d8; }

        /* ç»“æœé¢æ¿ Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; display: none; }
        .card { background: var(--card); padding: 20px; border-radius: 8px; border-top: 3px solid transparent; }
        .card h3 { margin-top: 0; color: #8b949e; font-size: 0.9em; border-bottom: 1px solid #333; padding-bottom: 10px; }
        ul { padding-left: 20px; line-height: 1.6; font-size: 0.95em; }
        li { margin-bottom: 8px; }

        /* ç‰¹å®šå¡ç‰‡æ ·å¼ */
        .verdict-card { grid-column: 1 / -1; text-align: center; border-color: var(--blue); background: linear-gradient(180deg, #1b1e26 0%, #161920 100%); }
        .tech-card { border-top-color: var(--blue); }
        .money-card { border-top-color: #f0b90b; }
        .risk-card { border-top-color: var(--red); }

        /* ä»·æ ¼ä¸åˆ†æ•° */
        .big-price { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
        .score-badge { display: inline-block; background: #333; padding: 5px 15px; border-radius: 20px; font-weight: bold; color: #f0b90b; margin-left: 10px; }
        
        .up { color: var(--red); }
        .down { color: var(--green); }
        
        /* Loading åŠ¨ç”» */
        .loading { text-align: center; display: none; margin-top: 50px; color: #888; }
        .spinner { width: 40px; height: 40px; border: 4px solid #333; border-top: 4px solid var(--blue); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align: center; margin-bottom: 20px;">
        <h1 style="margin:0; letter-spacing: 2px;">ALPHA TRADER <span style="color:var(--blue)">PRO</span></h1>
        <p style="color: #666; font-size: 0.9em;">Aè‚¡æ™ºèƒ½é‡åŒ–æŠ•ç ”ç³»ç»Ÿ | æˆ˜æ³•è¯†åˆ« | ç­¹ç åˆ†æ | é£é™©æ§åˆ¶</p>
    </div>

    <div class="header">
        <input type="text" id="code" placeholder="è¾“å…¥ä»£ç  (å¦‚ 600519)" value="600519">
        <button onclick="start()">å¼€å§‹åˆ†æ</button>
    </div>

    <div id="loading" class="loading">
        <div class="spinner"></div>
        <div>æ­£åœ¨è¿æ¥äº¤æ˜“æ‰€æ•°æ®æ¥å£...<br>æ­£åœ¨è¿›è¡Œå¤šå› å­é‡åŒ–è¿ç®—...</div>
    </div>

    <div id="dashboard" class="grid">
        <!-- æ ¸å¿ƒç»“è®ºåŒº -->
        <div class="card verdict-card">
            <h2 id="name">--</h2>
            <div id="price-area">
                <span id="price" class="big-price">--</span>
                <span id="pct" style="font-size: 1.2em;">--</span>
            </div>
            <div style="margin-top: 15px;">
                AI ç»¼åˆè¯„åˆ†: <span id="score" class="score-badge">--</span>
                <div id="verdict" style="margin-top:10px; font-size: 1.2em; font-weight: bold; color: var(--blue);">--</div>
            </div>
        </div>

        <!-- æŠ€æœ¯é¢ -->
        <div class="card tech-card">
            <h3>ğŸ“ˆ æŠ€æœ¯é¢ä¸æˆ˜æ³• (Technical)</h3>
            <ul id="tech-list"></ul>
        </div>

        <!-- èµ„é‡‘ä¸ç­¹ç  -->
        <div class="card money-card">
            <h3>ğŸ’° èµ„é‡‘ä¸ç­¹ç  (Capital & Chips)</h3>
            <ul id="capital-list"></ul>
        </div>

        <!-- åŸºæœ¬é¢ -->
        <div class="card">
            <h3>ğŸ¢ åŸºæœ¬é¢ (Fundamental)</h3>
            <ul id="fund-list"></ul>
        </div>

        <!-- é£æ§ -->
        <div class="card risk-card">
            <h3>ğŸ›¡ï¸ é£æ§ä¸ç­–ç•¥ (Risk Control)</h3>
            <ul id="risk-list"></ul>
        </div>

        <!-- æ¶ˆæ¯ -->
        <div class="card" style="grid-column: 1 / -1;">
            <h3>ğŸ“° å®æ—¶èˆ†æƒ… (News)</h3>
            <div id="news-list" style="font-size: 0.9em; color: #ccc;"></div>
        </div>
    </div>
</div>

<script>
    async function start() {
        const code = document.getElementById('code').value;
        const dash = document.getElementById('dashboard');
        const load = document.getElementById('loading');
        
        if(code.length !== 6) return alert("è¯·è¾“å…¥6ä½Aè‚¡ä»£ç ");
        
        dash.style.display = 'none';
        load.style.display = 'block';

        try {
            // æ³¨æ„ï¼šè¿™é‡Œè¿æ¥çš„æ˜¯æœ¬åœ°PythonæœåŠ¡
            const res = await fetch(`http://127.0.0.1:8000/analyze/${code}`);
            const data = await res.json();
            
            if(data.error) { alert(data.error); return; }

            // æ¸²æŸ“å¤´éƒ¨
            document.getElementById('name').innerText = `${data.name} (${code})`;
            const priceEl = document.getElementById('price');
            priceEl.innerText = data.price;
            priceEl.className = `big-price ${data.pct >= 0 ? 'up' : 'down'}`;
            
            const pctEl = document.getElementById('pct');
            pctEl.innerText = `${data.pct}%`;
            pctEl.className = data.pct >= 0 ? 'up' : 'down';

            document.getElementById('score').innerText = data.score;
            document.getElementById('verdict').innerText = data.verdict;

            // æ¸²æŸ“åˆ—è¡¨å‡½æ•°
            const renderList = (id, arr) => {
                const ul = document.getElementById(id);
                ul.innerHTML = '';
                if(arr.length === 0) ul.innerHTML = '<li>æš‚æ— ç‰¹åˆ«ä¿¡å·</li>';
                arr.forEach(txt => {
                    const li = document.createElement('li');
                    li.innerHTML = txt; // æ”¯æŒemoji
                    ul.appendChild(li);
                });
            };

            renderList('tech-list', data.report.technical);
            renderList('capital-list', data.report.capital);
            renderList('fund-list', data.report.fundamental);
            renderList('risk-list', data.report.risk);

            // æ¸²æŸ“æ–°é—»
            const newsDiv = document.getElementById('news-list');
            newsDiv.innerHTML = '';
            data.news.forEach(n => {
                const d = document.createElement('div');
                d.style.marginBottom = '8px';
                d.innerHTML = `<span style="color:#666">[${n.date}]</span> ${n.title}`;
                newsDiv.appendChild(d);
            });

            load.style.display = 'none';
            dash.style.display = 'grid';

        } catch(e) {
            alert("æ— æ³•è¿æ¥åå°ï¼è¯·ç¡®ä¿ main.py æ­£åœ¨è¿è¡Œã€‚");
            load.style.display = 'none';
        }
    }
</script>
</body>
</html>
